{
  "openapi": "3.0.0",
  "info": {
    "title": "Leads Rapido API",
    "version": "1.0.0",
    "description": "Plataforma SaaS B2B para gestão de leads e prospecção comercial",
    "contact": {
      "name": "API Support",
      "email": "support@leadsrapido.com.br"
    }
  },
  "servers": [
    {
      "url": "http://localhost:3000",
      "description": "Development server"
    },
    {
      "url": "http://localhost:3000",
      "description": "Development server"
    }
  ],
  "tags": [
    {
      "name": "Empresas",
      "description": "Operações relacionadas a empresas"
    },
    {
      "name": "Autenticação",
      "description": "Autenticação e autorização"
    },
    {
      "name": "Leads",
      "description": "Gerenciamento de leads B2B"
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "JWT Bearer token para autenticação de usuários"
      },
      "apiKeyAuth": {
        "type": "apiKey",
        "in": "header",
        "name": "X-API-Key",
        "description": "API Key da empresa para integrações e webhooks"
      }
    },
    "schemas": {
      "Error": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": false
          },
          "error": {
            "type": "string",
            "description": "Mensagem de erro"
          },
          "message": {
            "type": "string",
            "description": "Mensagem adicional do erro (opcional)"
          },
          "details": {
            "type": "object",
            "description": "Detalhes adicionais do erro (opcional)"
          }
        },
        "required": [
          "success",
          "error",
          "success",
          "error"
        ]
      },
      "ApiInfo": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "version": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "availableVersions": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "Status": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "operational",
              "maintenance",
              "error",
              "operational",
              "maintenance",
              "error"
            ]
          },
          "version": {
            "type": "string"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "LeadId": {
        "type": "string",
        "format": "uuid",
        "description": "Identificador único do lead",
        "example": "550e8400-e29b-41d4-a716-446655440000"
      },
      "QualityScore": {
        "type": "integer",
        "minimum": 0,
        "maximum": 100,
        "description": "Score de qualificação do lead (0-100)",
        "example": 85
      },
      "LeadStatus": {
        "type": "string",
        "enum": [
          "NOVO",
          "CONTATADO",
          "QUALIFICADO",
          "PROPOSTA_ENVIADA",
          "GANHO",
          "PERDIDO",
          "NOVO",
          "CONTATADO",
          "QUALIFICADO",
          "PROPOSTA_ENVIADA",
          "GANHO",
          "PERDIDO"
        ],
        "description": "Status atual do lead",
        "example": "QUALIFICADO"
      },
      "FonteLead": {
        "type": "string",
        "enum": [
          "MANUAL",
          "WEBSITE",
          "LINKEDIN",
          "INDICACAO",
          "EVENTO",
          "OUTROS",
          "MANUAL",
          "WEBSITE",
          "LINKEDIN",
          "INDICACAO",
          "EVENTO",
          "OUTROS"
        ],
        "description": "Fonte/origem do lead",
        "example": "LINKEDIN"
      },
      "PorteEmpresa": {
        "type": "string",
        "enum": [
          "MEI",
          "Micro",
          "Pequena",
          "Média",
          "Grande",
          "MEI",
          "Micro",
          "Pequena",
          "Média",
          "Grande"
        ],
        "description": "Porte da empresa",
        "example": "Pequena"
      },
      "EnderecoCompleto": {
        "type": "object",
        "properties": {
          "rua": {
            "type": "string",
            "description": "Nome da rua",
            "example": "Rua das Flores"
          },
          "numero": {
            "type": "string",
            "description": "Número do endereço",
            "example": "123"
          },
          "cidade": {
            "type": "string",
            "description": "Cidade",
            "example": "São Paulo"
          },
          "estado": {
            "type": "string",
            "description": "Estado",
            "example": "SP"
          },
          "cep": {
            "type": "string",
            "description": "CEP",
            "example": "01234-567"
          },
          "pais": {
            "type": "string",
            "description": "País",
            "example": "Brasil"
          },
          "latitude": {
            "type": "number",
            "format": "float",
            "description": "Latitude",
            "example": -23.55052
          },
          "longitude": {
            "type": "number",
            "format": "float",
            "description": "Longitude",
            "example": -46.633308
          }
        },
        "required": [
          "rua",
          "numero",
          "cidade",
          "estado",
          "cep",
          "pais",
          "rua",
          "numero",
          "cidade",
          "estado",
          "cep",
          "pais"
        ]
      },
      "CreateLeadDTO": {
        "type": "object",
        "required": [
          "organizationId",
          "nomeEmpresa",
          "organizationId",
          "nomeEmpresa"
        ],
        "properties": {
          "organizationId": {
            "type": "string",
            "description": "ID da organização (multi-tenant)",
            "example": "org-123"
          },
          "nomeEmpresa": {
            "type": "string",
            "description": "Nome da empresa",
            "example": "Tech Solutions Ltda"
          },
          "nomeContato": {
            "type": "string",
            "description": "Nome do contato principal",
            "example": "João Silva"
          },
          "cargoContato": {
            "type": "string",
            "description": "Cargo do contato",
            "example": "Diretor de TI"
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "Email do contato",
            "example": "joao.silva@techsolutions.com"
          },
          "telefone": {
            "type": "string",
            "description": "Telefone do contato",
            "example": "(11) 99999-9999"
          },
          "linkedinUrl": {
            "type": "string",
            "format": "uri",
            "description": "URL do LinkedIn",
            "example": "https://linkedin.com/in/joaosilva"
          },
          "siteEmpresa": {
            "type": "string",
            "format": "uri",
            "description": "Website da empresa",
            "example": "https://techsolutions.com"
          },
          "cnpj": {
            "type": "string",
            "description": "CNPJ da empresa",
            "example": "12.345.678/0001-90"
          },
          "segmento": {
            "type": "string",
            "description": "Segmento de atuação",
            "example": "Tecnologia da Informação"
          },
          "porteEmpresa": {
            "$ref": "#/components/schemas/PorteEmpresa"
          },
          "numFuncionarios": {
            "type": "integer",
            "description": "Número de funcionários",
            "example": 50
          },
          "receitaAnualEstimada": {
            "type": "number",
            "format": "float",
            "description": "Receita anual estimada (R$)",
            "example": 5000000
          },
          "endereco": {
            "$ref": "#/components/schemas/EnderecoCompleto"
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Tags para categorização",
            "example": [
              "tecnologia",
              "startup",
              "sao-paulo",
              "tecnologia",
              "startup",
              "sao-paulo"
            ]
          },
          "observacoes": {
            "type": "string",
            "description": "Observações adicionais",
            "example": "Empresa em crescimento, interessada em soluções de IA"
          },
          "fonte": {
            "$ref": "#/components/schemas/FonteLead"
          },
          "dadosOriginais": {
            "type": "object",
            "description": "Dados originais da fonte",
            "example": {
              "campaign_id": "camp-123",
              "source": "linkedin-ads"
            }
          },
          "custoAquisicao": {
            "type": "number",
            "format": "float",
            "description": "Custo de aquisição (R$)",
            "example": 150
          }
        }
      },
      "UpdateLeadDTO": {
        "type": "object",
        "properties": {
          "nomeContato": {
            "type": "string",
            "description": "Nome do contato principal",
            "example": "João Silva"
          },
          "cargoContato": {
            "type": "string",
            "description": "Cargo do contato",
            "example": "Diretor de TI"
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "Email do contato",
            "example": "joao.silva@techsolutions.com"
          },
          "telefone": {
            "type": "string",
            "description": "Telefone do contato",
            "example": "(11) 99999-9999"
          },
          "linkedinUrl": {
            "type": "string",
            "format": "uri",
            "description": "URL do LinkedIn",
            "example": "https://linkedin.com/in/joaosilva"
          },
          "siteEmpresa": {
            "type": "string",
            "format": "uri",
            "description": "Website da empresa",
            "example": "https://techsolutions.com"
          },
          "cnpj": {
            "type": "string",
            "description": "CNPJ da empresa",
            "example": "12.345.678/0001-90"
          },
          "segmento": {
            "type": "string",
            "description": "Segmento de atuação",
            "example": "Tecnologia da Informação"
          },
          "porteEmpresa": {
            "$ref": "#/components/schemas/PorteEmpresa"
          },
          "numFuncionarios": {
            "type": "integer",
            "description": "Número de funcionários",
            "example": 50
          },
          "receitaAnualEstimada": {
            "type": "number",
            "format": "float",
            "description": "Receita anual estimada (R$)",
            "example": 5000000
          },
          "endereco": {
            "$ref": "#/components/schemas/EnderecoCompleto"
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Tags para categorização",
            "example": [
              "tecnologia",
              "startup",
              "sao-paulo",
              "tecnologia",
              "startup",
              "sao-paulo"
            ]
          },
          "observacoes": {
            "type": "string",
            "description": "Observações adicionais",
            "example": "Empresa em crescimento, interessada em soluções de IA"
          },
          "dadosOriginais": {
            "type": "object",
            "description": "Dados originais da fonte",
            "example": {
              "campaign_id": "camp-123",
              "source": "linkedin-ads"
            }
          },
          "custoAquisicao": {
            "type": "number",
            "format": "float",
            "description": "Custo de aquisição (R$)",
            "example": 150
          }
        }
      },
      "LeadFiltersDTO": {
        "type": "object",
        "properties": {
          "status": {
            "$ref": "#/components/schemas/LeadStatus"
          },
          "scoreMin": {
            "type": "integer",
            "minimum": 0,
            "maximum": 100,
            "description": "Score mínimo",
            "example": 70
          },
          "scoreMax": {
            "type": "integer",
            "minimum": 0,
            "maximum": 100,
            "description": "Score máximo",
            "example": 100
          },
          "segmento": {
            "type": "string",
            "description": "Filtrar por segmento",
            "example": "Tecnologia"
          },
          "porteEmpresa": {
            "$ref": "#/components/schemas/PorteEmpresa"
          },
          "fonte": {
            "$ref": "#/components/schemas/FonteLead"
          },
          "search": {
            "type": "string",
            "description": "Busca textual (nome empresa, contato, email)",
            "example": "Tech Solutions"
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Filtrar por tags",
            "example": [
              "tecnologia",
              "startup",
              "tecnologia",
              "startup"
            ]
          },
          "createdAfter": {
            "type": "string",
            "format": "date-time",
            "description": "Criado após esta data",
            "example": "2024-01-01T00:00:00Z"
          },
          "createdBefore": {
            "type": "string",
            "format": "date-time",
            "description": "Criado antes desta data",
            "example": "2024-12-31T23:59:59Z"
          }
        }
      },
      "PaginationDTO": {
        "type": "object",
        "properties": {
          "page": {
            "type": "integer",
            "minimum": 1,
            "default": 1,
            "description": "Página atual",
            "example": 1
          },
          "limit": {
            "type": "integer",
            "minimum": 1,
            "maximum": 100,
            "default": 20,
            "description": "Itens por página",
            "example": 20
          },
          "sortBy": {
            "type": "string",
            "default": "createdAt",
            "description": "Campo para ordenação",
            "example": "createdAt"
          },
          "sortOrder": {
            "type": "string",
            "enum": [
              "asc",
              "desc",
              "asc",
              "desc"
            ],
            "default": "desc",
            "description": "Direção da ordenação",
            "example": "desc"
          }
        }
      },
      "LeadResponseDTO": {
        "type": "object",
        "properties": {
          "id": {
            "$ref": "#/components/schemas/LeadId"
          },
          "organizationId": {
            "type": "string",
            "description": "ID da organização",
            "example": "org-123"
          },
          "nomeEmpresa": {
            "type": "string",
            "description": "Nome da empresa",
            "example": "Tech Solutions Ltda"
          },
          "nomeContato": {
            "type": "string",
            "description": "Nome do contato principal",
            "example": "João Silva"
          },
          "cargoContato": {
            "type": "string",
            "description": "Cargo do contato",
            "example": "Diretor de TI"
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "Email do contato",
            "example": "joao.silva@techsolutions.com"
          },
          "telefone": {
            "type": "string",
            "description": "Telefone do contato",
            "example": "(11) 99999-9999"
          },
          "linkedinUrl": {
            "type": "string",
            "format": "uri",
            "description": "URL do LinkedIn",
            "example": "https://linkedin.com/in/joaosilva"
          },
          "siteEmpresa": {
            "type": "string",
            "format": "uri",
            "description": "Website da empresa",
            "example": "https://techsolutions.com"
          },
          "cnpj": {
            "type": "string",
            "description": "CNPJ da empresa",
            "example": "12.345.678/0001-90"
          },
          "segmento": {
            "type": "string",
            "description": "Segmento de atuação",
            "example": "Tecnologia da Informação"
          },
          "porteEmpresa": {
            "$ref": "#/components/schemas/PorteEmpresa"
          },
          "numFuncionarios": {
            "type": "integer",
            "description": "Número de funcionários",
            "example": 50
          },
          "receitaAnualEstimada": {
            "type": "number",
            "format": "float",
            "description": "Receita anual estimada (R$)",
            "example": 5000000
          },
          "endereco": {
            "$ref": "#/components/schemas/EnderecoCompleto"
          },
          "status": {
            "$ref": "#/components/schemas/LeadStatus"
          },
          "scoreQualificacao": {
            "$ref": "#/components/schemas/QualityScore"
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Tags para categorização",
            "example": [
              "tecnologia",
              "startup",
              "sao-paulo",
              "tecnologia",
              "startup",
              "sao-paulo"
            ]
          },
          "observacoes": {
            "type": "string",
            "description": "Observações adicionais",
            "example": "Empresa em crescimento, interessada em soluções de IA"
          },
          "fonte": {
            "$ref": "#/components/schemas/FonteLead"
          },
          "dadosOriginais": {
            "type": "object",
            "description": "Dados originais da fonte",
            "example": {
              "campaign_id": "camp-123",
              "source": "linkedin-ads"
            }
          },
          "custoAquisicao": {
            "type": "number",
            "format": "float",
            "description": "Custo de aquisição (R$)",
            "example": 150
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "Data de criação",
            "example": "2024-08-31T10:30:00Z"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time",
            "description": "Data de atualização",
            "example": "2024-08-31T15:45:00Z"
          }
        },
        "required": [
          "id",
          "organizationId",
          "nomeEmpresa",
          "fonte",
          "status",
          "scoreQualificacao",
          "createdAt",
          "updatedAt",
          "id",
          "organizationId",
          "nomeEmpresa",
          "fonte",
          "status",
          "scoreQualificacao",
          "createdAt",
          "updatedAt"
        ]
      },
      "PagedLeadResponse": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/LeadResponseDTO"
            },
            "description": "Lista de leads"
          },
          "total": {
            "type": "integer",
            "description": "Total de itens",
            "example": 150
          },
          "page": {
            "type": "integer",
            "description": "Página atual",
            "example": 1
          },
          "limit": {
            "type": "integer",
            "description": "Itens por página",
            "example": 20
          },
          "totalPages": {
            "type": "integer",
            "description": "Total de páginas",
            "example": 8
          },
          "hasNext": {
            "type": "boolean",
            "description": "Tem próxima página",
            "example": true
          },
          "hasPrev": {
            "type": "boolean",
            "description": "Tem página anterior",
            "example": false
          }
        },
        "required": [
          "items",
          "total",
          "page",
          "limit",
          "totalPages",
          "hasNext",
          "hasPrev",
          "items",
          "total",
          "page",
          "limit",
          "totalPages",
          "hasNext",
          "hasPrev"
        ]
      },
      "SuccessResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": true
          },
          "data": {
            "type": "object",
            "description": "Dados da resposta"
          },
          "message": {
            "type": "string",
            "description": "Mensagem de sucesso",
            "example": "Operação realizada com sucesso"
          }
        },
        "required": [
          "success",
          "success"
        ]
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": false
          },
          "message": {
            "type": "string",
            "description": "Mensagem de erro",
            "example": "Dados inválidos"
          }
        },
        "required": [
          "success",
          "message",
          "success",
          "message"
        ]
      }
    }
  },
  "security": [
    {
      "bearerAuth": []
    },
    {
      "bearerAuth": []
    }
  ],
  "paths": {
    "/api": {
      "get": {
        "tags": [
          "System"
        ],
        "summary": "Informações da API",
        "description": "Retorna informações básicas sobre a API",
        "responses": {
          "200": {
            "description": "Informações da API retornadas com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiInfo"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/status": {
      "get": {
        "tags": [
          "System"
        ],
        "summary": "Status da API",
        "description": "Retorna o status atual da API",
        "responses": {
          "200": {
            "description": "Status da API retornado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Status"
                }
              }
            }
          }
        }
      }
    },
    "/health": {
      "get": {
        "tags": [
          "System"
        ],
        "summary": "Health check",
        "description": "Verifica se a API está funcionando",
        "responses": {
          "200": {
            "description": "API está funcionando",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "healthy"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/auth/login": {
      "post": {
        "summary": "Fazer login no sistema",
        "tags": [
          "Autenticação"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "email",
                  "password"
                ],
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email",
                    "description": "Email do usuário"
                  },
                  "password": {
                    "type": "string",
                    "description": "Senha do usuário"
                  },
                  "cnpj": {
                    "type": "string",
                    "description": "CNPJ da empresa (opcional)"
                  },
                  "empresa_id": {
                    "type": "string",
                    "description": "ID da empresa (opcional - deprecated, use cnpj)"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Login realizado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "token": {
                      "type": "string",
                      "description": "JWT token de autenticação"
                    },
                    "user": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "email": {
                          "type": "string"
                        },
                        "role": {
                          "type": "string"
                        },
                        "empresa_id": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Dados inválidos"
          },
          "401": {
            "description": "Credenciais inválidas"
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      }
    },
    "/api/v1/empresas": {
      "get": {
        "summary": "Listar todas as empresas",
        "tags": [
          "Empresas"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Lista de empresas retornada com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/EmpresaResponse"
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Não autorizado"
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      },
      "post": {
        "summary": "Criar nova empresa",
        "tags": [
          "Empresas"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateEmpresaData"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Empresa criada com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "$ref": "#/components/schemas/EmpresaResponse"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Dados inválidos"
          },
          "401": {
            "description": "Não autorizado"
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      }
    },
    "/api/v1/empresas/{id}": {
      "get": {
        "summary": "Obter empresa por ID",
        "tags": [
          "Empresas"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ID da empresa"
          }
        ],
        "responses": {
          "200": {
            "description": "Empresa encontrada",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "$ref": "#/components/schemas/EmpresaResponse"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Não autorizado"
          },
          "404": {
            "description": "Empresa não encontrada"
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      },
      "put": {
        "summary": "Atualizar empresa",
        "tags": [
          "Empresas"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ID da empresa"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateEmpresaData"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Empresa atualizada com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "$ref": "#/components/schemas/EmpresaResponse"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Dados inválidos"
          },
          "401": {
            "description": "Não autorizado"
          },
          "404": {
            "description": "Empresa não encontrada"
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      },
      "delete": {
        "summary": "Deletar empresa",
        "tags": [
          "Empresas"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ID da empresa"
          }
        ],
        "responses": {
          "204": {
            "description": "Empresa deletada com sucesso"
          },
          "401": {
            "description": "Não autorizado"
          },
          "404": {
            "description": "Empresa não encontrada"
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      }
    },
    "/api/leads": {
      "post": {
        "tags": [
          "Leads"
        ],
        "summary": "Criar um novo lead",
        "description": "Cria um novo lead no sistema com validação completa dos dados",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateLeadDTO"
              },
              "example": {
                "nomeEmpresa": "Empresa Exemplo Ltda",
                "nomeContato": "João Silva",
                "cargoContato": "Diretor Executivo",
                "email": "joao.silva@empresa.com",
                "telefone": "+55 11 99999-9999",
                "linkedinUrl": "https://linkedin.com/in/joaosilva",
                "siteEmpresa": "https://empresa.com",
                "cnpj": "12.345.678/0001-90",
                "segmento": "Tecnologia",
                "porteEmpresa": "Médio",
                "numFuncionarios": 50,
                "receitaAnualEstimada": 5000000,
                "endereco": {
                  "rua": "Rua das Flores",
                  "numero": "123",
                  "cidade": "São Paulo",
                  "estado": "SP",
                  "cep": "01234-567",
                  "pais": "Brasil"
                },
                "status": "novo",
                "tags": [
                  "tecnologia",
                  "b2b"
                ],
                "observacoes": "Lead identificado via LinkedIn",
                "fonte": "linkedin",
                "dadosOriginais": {},
                "custoAquisicao": 150
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Lead criado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "$ref": "#/components/schemas/LeadResponseDTO"
                    },
                    "message": {
                      "type": "string",
                      "example": "Lead criado com sucesso"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Dados inválidos",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "message": {
                      "type": "string",
                      "example": "Email é obrigatório"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Não autorizado"
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      },
      "get": {
        "tags": [
          "Leads"
        ],
        "summary": "Listar leads com filtros e paginação",
        "description": "Lista leads da organização com suporte a filtros avançados e paginação",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "default": 1
            },
            "description": "Número da página"
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 20
            },
            "description": "Número de itens por página"
          },
          {
            "in": "query",
            "name": "sortBy",
            "schema": {
              "type": "string",
              "enum": [
                "createdAt",
                "updatedAt",
                "nomeEmpresa",
                "scoreQualificacao"
              ],
              "default": "createdAt"
            },
            "description": "Campo para ordenação"
          },
          {
            "in": "query",
            "name": "sortOrder",
            "schema": {
              "type": "string",
              "enum": [
                "asc",
                "desc"
              ],
              "default": "desc"
            },
            "description": "Ordem de ordenação"
          },
          {
            "in": "query",
            "name": "status",
            "schema": {
              "type": "string",
              "enum": [
                "novo",
                "contato_inicial",
                "qualificado",
                "proposta",
                "fechado",
                "perdido"
              ]
            },
            "description": "Filtrar por status do lead"
          },
          {
            "in": "query",
            "name": "scoreMin",
            "schema": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100
            },
            "description": "Score mínimo de qualificação"
          },
          {
            "in": "query",
            "name": "scoreMax",
            "schema": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100
            },
            "description": "Score máximo de qualificação"
          },
          {
            "in": "query",
            "name": "segmento",
            "schema": {
              "type": "string"
            },
            "description": "Filtrar por segmento da empresa"
          },
          {
            "in": "query",
            "name": "porteEmpresa",
            "schema": {
              "type": "string",
              "enum": [
                "Pequeno",
                "Médio",
                "Grande"
              ]
            },
            "description": "Filtrar por porte da empresa"
          },
          {
            "in": "query",
            "name": "fonte",
            "schema": {
              "type": "string"
            },
            "description": "Filtrar por fonte de origem"
          },
          {
            "in": "query",
            "name": "search",
            "schema": {
              "type": "string"
            },
            "description": "Busca textual em nome da empresa, contato e email"
          },
          {
            "in": "query",
            "name": "tags",
            "schema": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "description": "Filtrar por tags (múltiplas tags separadas por vírgula)"
          },
          {
            "in": "query",
            "name": "createdAfter",
            "schema": {
              "type": "string",
              "format": "date-time"
            },
            "description": "Leads criados após esta data"
          },
          {
            "in": "query",
            "name": "createdBefore",
            "schema": {
              "type": "string",
              "format": "date-time"
            },
            "description": "Leads criados antes desta data"
          }
        ],
        "responses": {
          "200": {
            "description": "Lista de leads retornada com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "items": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/LeadResponseDTO"
                          }
                        },
                        "total": {
                          "type": "integer",
                          "example": 150
                        },
                        "page": {
                          "type": "integer",
                          "example": 1
                        },
                        "limit": {
                          "type": "integer",
                          "example": 20
                        },
                        "totalPages": {
                          "type": "integer",
                          "example": 8
                        },
                        "hasNext": {
                          "type": "boolean",
                          "example": true
                        },
                        "hasPrev": {
                          "type": "boolean",
                          "example": false
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Não autorizado"
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      }
    },
    "/api/leads/{id}": {
      "get": {
        "tags": [
          "Leads"
        ],
        "summary": "Buscar lead por ID",
        "description": "Busca um lead específico pelo seu ID único",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "ID único do lead",
            "example": "lead-123e4567-e89b-12d3-a456-426614174000"
          }
        ],
        "responses": {
          "200": {
            "description": "Lead encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "$ref": "#/components/schemas/LeadResponseDTO"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Não autorizado"
          },
          "403": {
            "description": "Acesso negado - lead pertence a outra organização",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "message": {
                      "type": "string",
                      "example": "Acesso negado"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Lead não encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "message": {
                      "type": "string",
                      "example": "Lead não encontrado"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      },
      "put": {
        "tags": [
          "Leads"
        ],
        "summary": "Atualizar lead",
        "description": "Atualiza os dados de um lead existente",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "ID único do lead",
            "example": "lead-123e4567-e89b-12d3-a456-426614174000"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateLeadDTO"
              },
              "example": {
                "nomeEmpresa": "Empresa Exemplo Ltda - Atualizado",
                "nomeContato": "João Silva Santos",
                "cargoContato": "CEO",
                "email": "joao.santos@empresa.com",
                "telefone": "+55 11 99999-8888",
                "status": "qualificado",
                "scoreQualificacao": 85,
                "tags": [
                  "tecnologia",
                  "b2b",
                  "qualificado"
                ],
                "observacoes": "Lead qualificado após reunião inicial"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Lead atualizado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "$ref": "#/components/schemas/LeadResponseDTO"
                    },
                    "message": {
                      "type": "string",
                      "example": "Lead atualizado com sucesso"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Dados inválidos",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "message": {
                      "type": "string",
                      "example": "Email é obrigatório"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Não autorizado"
          },
          "403": {
            "description": "Acesso negado - lead pertence a outra organização",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "message": {
                      "type": "string",
                      "example": "Acesso negado"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Lead não encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "message": {
                      "type": "string",
                      "example": "Lead não encontrado"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      },
      "delete": {
        "tags": [
          "Leads"
        ],
        "summary": "Deletar lead",
        "description": "Remove permanentemente um lead do sistema",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "ID único do lead",
            "example": "lead-123e4567-e89b-12d3-a456-426614174000"
          }
        ],
        "responses": {
          "200": {
            "description": "Lead deletado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Lead deletado com sucesso"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Não autorizado"
          },
          "403": {
            "description": "Acesso negado - lead pertence a outra organização",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "message": {
                      "type": "string",
                      "example": "Acesso negado"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Lead não encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "message": {
                      "type": "string",
                      "example": "Lead não encontrado"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      }
    },
    "/api/v1/users": {
      "post": {
        "summary": "Criar novo usuário na empresa",
        "description": "Cria um novo usuário associado à empresa do token.\nRequer permissão CREATE_USER.\n\n**Regras de Hierarquia:**\n- Admin pode criar: admin, gerente, usuario\n- Gerente pode criar: usuario\n- Usuario não pode criar outros usuários\n\n**Segurança:**\n- Isolamento rigoroso por empresa (multi-tenant)\n- Prevenção de escalação de privilégios\n- Auditoria completa de criações\n",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "nome",
                  "email",
                  "role"
                ],
                "properties": {
                  "nome": {
                    "type": "string",
                    "minLength": 2,
                    "maxLength": 100,
                    "description": "Nome completo do usuário",
                    "example": "João Silva Santos"
                  },
                  "email": {
                    "type": "string",
                    "format": "email",
                    "description": "Email único do usuário (será usado para login)",
                    "example": "joao.silva@empresa.com"
                  },
                  "telefone": {
                    "type": "string",
                    "minLength": 10,
                    "maxLength": 15,
                    "description": "Telefone do usuário (opcional)",
                    "example": "(11) 99999-9999"
                  },
                  "role": {
                    "type": "string",
                    "enum": [
                      "admin",
                      "gerente",
                      "usuario"
                    ],
                    "description": "Role inicial do usuário (sujeita à validação hierárquica)",
                    "example": "usuario"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Usuário criado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Usuário 'João Silva Santos' criado com sucesso"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "user": {
                          "$ref": "#/components/schemas/UserResponse"
                        },
                        "inviteToken": {
                          "type": "string",
                          "description": "Token para primeiro acesso (se aplicável)"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Dados inválidos",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "401": {
            "description": "Token inválido ou ausente"
          },
          "403": {
            "description": "Permissão insuficiente ou escalação de privilégios",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "error": {
                      "type": "string",
                      "example": "Usuário com role 'gerente' não pode atribuir role 'admin'"
                    },
                    "code": {
                      "type": "string",
                      "example": "ROLE_ASSIGNMENT_FORBIDDEN"
                    }
                  }
                }
              }
            }
          },
          "409": {
            "description": "Email já existe na empresa"
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      },
      "get": {
        "summary": "Listar usuários da empresa",
        "description": "Lista usuários da empresa com filtragem e paginação.\nFiltragem diferencial baseada no role do solicitante.\n\n**Acesso por Role:**\n- Admin: vê todos os usuários com dados completos\n- Gerente: vê todos exceto alguns metadados de admin\n- Usuario: vê apenas lista básica (nome, role)\n",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "page",
            "description": "Página (inicia em 1)",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "default": 1,
              "example": 1
            }
          },
          {
            "in": "query",
            "name": "limit",
            "description": "Itens por página",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 20,
              "example": 20
            }
          },
          {
            "in": "query",
            "name": "role",
            "description": "Filtrar por role específica",
            "schema": {
              "type": "string",
              "enum": [
                "admin",
                "gerente",
                "usuario"
              ],
              "example": "usuario"
            }
          },
          {
            "in": "query",
            "name": "ativo",
            "description": "Filtrar por status ativo",
            "schema": {
              "type": "boolean",
              "example": true
            }
          },
          {
            "in": "query",
            "name": "search",
            "description": "Buscar por nome ou email",
            "schema": {
              "type": "string",
              "minLength": 2,
              "example": "joão silva"
            }
          },
          {
            "in": "query",
            "name": "sortBy",
            "description": "Campo para ordenação",
            "schema": {
              "type": "string",
              "enum": [
                "nome",
                "email",
                "createdAt",
                "role"
              ],
              "default": "nome",
              "example": "createdAt"
            }
          },
          {
            "in": "query",
            "name": "sortOrder",
            "description": "Ordem da classificação",
            "schema": {
              "type": "string",
              "enum": [
                "asc",
                "desc"
              ],
              "default": "asc",
              "example": "desc"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Lista de usuários",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "users": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/UserResponse"
                          }
                        },
                        "pagination": {
                          "type": "object",
                          "properties": {
                            "page": {
                              "type": "integer",
                              "example": 1
                            },
                            "limit": {
                              "type": "integer",
                              "example": 20
                            },
                            "total": {
                              "type": "integer",
                              "example": 45
                            },
                            "totalPages": {
                              "type": "integer",
                              "example": 3
                            },
                            "hasNext": {
                              "type": "boolean",
                              "example": true
                            },
                            "hasPrev": {
                              "type": "boolean",
                              "example": false
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Token inválido ou ausente"
          },
          "403": {
            "description": "Sem permissão para listar usuários"
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      }
    },
    "/api/v1/users/{id}": {
      "get": {
        "summary": "Buscar usuário por ID",
        "description": "Retorna dados de um usuário específico com filtragem baseada no role.\n\n**Filtragem Diferencial:**\n- Admin: vê todos os dados (incluindo telefone, status, timestamps)\n- Gerente: vê dados completos exceto alguns metadados\n- Usuario: vê apenas dados básicos (nome, email, role)\n\n**Acesso Próprio:**\n- Qualquer usuário pode ver seu próprio perfil completo\n",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "description": "UUID do usuário",
            "schema": {
              "type": "string",
              "format": "uuid",
              "example": "123e4567-e89b-12d3-a456-426614174000"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Usuário encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "$ref": "#/components/schemas/UserResponse"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Token inválido ou ausente"
          },
          "403": {
            "description": "Sem permissão para ver este usuário"
          },
          "404": {
            "description": "Usuário não encontrado na empresa"
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      },
      "put": {
        "summary": "Atualizar usuário",
        "description": "Atualiza dados de um usuário com validação hierárquica.\n\n**Regras:**\n- Usuários podem atualizar apenas nome/telefone próprios\n- Admin/Gerente podem atualizar outros usuários\n- Gerente não pode atualizar Admin\n- Status 'ativo' requer permissões especiais\n",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "description": "UUID do usuário",
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "nome": {
                    "type": "string",
                    "minLength": 2,
                    "maxLength": 100,
                    "example": "João Silva Santos Atualizado"
                  },
                  "telefone": {
                    "type": "string",
                    "minLength": 10,
                    "maxLength": 15,
                    "example": "(11) 88888-8888"
                  },
                  "ativo": {
                    "type": "boolean",
                    "description": "Apenas Admin/Gerente podem alterar",
                    "example": true
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Usuário atualizado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Usuário 'João Silva Santos' foi atualizado com sucesso"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "user": {
                          "$ref": "#/components/schemas/UserResponse"
                        },
                        "updatedFields": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "example": [
                            "nome",
                            "telefone"
                          ]
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Dados inválidos"
          },
          "401": {
            "description": "Token inválido ou ausente"
          },
          "403": {
            "description": "Sem permissão para atualizar este usuário"
          },
          "404": {
            "description": "Usuário não encontrado"
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      },
      "delete": {
        "summary": "Desativar usuário (soft delete)",
        "description": "Remove usuário da empresa (soft delete) preservando dados do auth.users.\n\n**Proteções:**\n- Não pode desativar a si mesmo\n- Gerente não pode desativar Admin\n- Não pode desativar o último Admin da empresa\n\n**Funcionamento:**\n- Remove registro da tabela empresa_user\n- Preserva usuário no auth.users do Supabase\n- Permite reativação futura\n",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "description": "UUID do usuário",
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "reason": {
                    "type": "string",
                    "maxLength": 255,
                    "description": "Motivo da desativação (para auditoria)",
                    "example": "Saída da empresa"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Usuário desativado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Usuário 'João Silva Santos' foi desativado com sucesso"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "deactivatedUser": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string"
                            },
                            "nome": {
                              "type": "string"
                            },
                            "email": {
                              "type": "string"
                            },
                            "role": {
                              "type": "string"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Dados inválidos"
          },
          "401": {
            "description": "Token inválido ou ausente"
          },
          "403": {
            "description": "Sem permissão ou violação de proteção",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "error": {
                      "type": "string",
                      "example": "Não é possível desativar o último administrador da empresa"
                    },
                    "code": {
                      "type": "string",
                      "example": "LAST_ADMIN_PROTECTION"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Usuário não encontrado"
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      }
    },
    "/api/v1/users/{id}/roles": {
      "post": {
        "summary": "Atribuir role ao usuário",
        "description": "Atribui nova role ao usuário com validação hierárquica rigorosa.\n\n**Matriz de Permissões:**\n- Admin: pode atribuir admin, gerente, usuario\n- Gerente: pode atribuir apenas usuario\n- Usuario: não pode atribuir roles\n\n**Proteções:**\n- Não pode alterar própria role\n- Gerente não pode promover/rebaixar Admin\n- Não pode rebaixar último Admin da empresa\n- Auditoria crítica para promoções a Admin\n",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "description": "UUID do usuário",
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "newRole"
                ],
                "properties": {
                  "newRole": {
                    "type": "string",
                    "enum": [
                      "admin",
                      "gerente",
                      "usuario"
                    ],
                    "description": "Nova role para o usuário",
                    "example": "gerente"
                  },
                  "reason": {
                    "type": "string",
                    "maxLength": 255,
                    "description": "Motivo da mudança (para auditoria)",
                    "example": "Promoção para liderança de equipe"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Role atribuída com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Role 'gerente' atribuída com sucesso ao usuário 'João Silva'"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "user": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "string"
                            },
                            "nome": {
                              "type": "string"
                            },
                            "email": {
                              "type": "string"
                            },
                            "previousRole": {
                              "type": "string"
                            },
                            "newRole": {
                              "type": "string"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Dados inválidos ou role já atribuída",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "error": {
                      "type": "string",
                      "example": "Usuário já possui a role 'gerente'"
                    },
                    "code": {
                      "type": "string",
                      "example": "ROLE_UNCHANGED"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Token inválido ou ausente"
          },
          "403": {
            "description": "Sem permissão ou violação hierárquica",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "error": {
                      "type": "string",
                      "example": "Usuário com role 'gerente' não pode atribuir role 'admin'"
                    },
                    "code": {
                      "type": "string",
                      "example": "ROLE_ASSIGNMENT_FORBIDDEN"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Usuário não encontrado"
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      }
    },
    "/api/v1/users/me": {
      "get": {
        "summary": "Obter perfil próprio",
        "description": "Retorna dados completos do usuário autenticado.\nNão requer permissões especiais além da autenticação.\n",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Perfil do usuário",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "$ref": "#/components/schemas/UserResponse"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Token inválido ou ausente"
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      },
      "put": {
        "summary": "Atualizar perfil próprio",
        "description": "Permite que usuário atualize apenas nome e telefone próprios.\nPara outras alterações, usar endpoint de administração.\n",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "nome": {
                    "type": "string",
                    "minLength": 2,
                    "maxLength": 100,
                    "example": "João Silva Santos"
                  },
                  "telefone": {
                    "type": "string",
                    "minLength": 10,
                    "maxLength": 15,
                    "example": "(11) 99999-9999"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Perfil atualizado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Seu perfil foi atualizado com sucesso"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "user": {
                          "$ref": "#/components/schemas/UserResponse"
                        },
                        "updatedFields": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "example": [
                            "nome",
                            "telefone"
                          ]
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Dados inválidos ou campos não permitidos",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "error": {
                      "type": "string",
                      "example": "Usuário não pode alterar seu próprio ativo"
                    },
                    "code": {
                      "type": "string",
                      "example": "SELF_UPDATE_FORBIDDEN"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Token inválido ou ausente"
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      }
    }
  }
}